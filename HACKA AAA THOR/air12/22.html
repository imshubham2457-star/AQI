<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Air Quality India — CrowdAQI</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --bg1: #0f172a;
      --bg2: #1e293b;
      --card: rgba(255,255,255,0.10);
      --accent: #7c3aed;
      --accent-2: #06b6d4;
      --glow: rgba(124,58,237,0.25);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
    }
    html,body{height:100%}
    body{
      font-family:'Inter',sans-serif;
      margin:0;min-height:100vh;
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#e6eef8;display:flex;
      align-items:center;justify-content:center;
      padding:20px;overflow-x:hidden;position:relative;
    }
    
    /* Air Flow Particles */
    .air-particle {
      position: absolute;
      background: rgba(124, 58, 237, 0.3);
      border-radius: 50%;
      pointer-events: none;
      z-index: -1;
      animation: airFloat 20s linear infinite;
    }
    
    @keyframes airFloat {
      0% {
        transform: translateY(100vh) translateX(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.3;
      }
      90% {
        opacity: 0.3;
      }
      100% {
        transform: translateY(-100px) translateX(100px) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* Wind Lines */
    .wind-line {
      position: absolute;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(124,58,237,0.6), transparent);
      animation: windMove 8s linear infinite;
      z-index: -1;
    }
    
    @keyframes windMove {
      0% {
        transform: translateX(-100vw);
        opacity: 0;
      }
      10% {
        opacity: 0.5;
      }
      90% {
        opacity: 0.5;
      }
      100% {
        transform: translateX(100vw);
        opacity: 0;
      }
    }
    
    /* background bubbles */
    .bg-bubble{
      position:fixed;z-index:-1;border-radius:50%;opacity:.42;
      filter:blur(32px);animation:bubblemove 18s cubic-bezier(.25,.46,.45,.94) infinite alternate;
    }
    .bg-bubble1{top:0;left:10vw;width:240px;height:240px;background:var(--accent);}
    .bg-bubble2{top:60vh;right:-80px;width:200px;height:200px;background:var(--accent-2);}
    .bg-bubble3{bottom:-80px;left:30vw;width:160px;height:160px;background:rgba(255,255,255,0.15);}
    
    @keyframes bubblemove {
      from{transform:translateY(0);}
      to{transform:translateY(-42px);}
    }
    
    .container{
      width:100%;max-width:1200px;display:grid;grid-template-columns: 1fr 450px;gap:40px;align-items:start;
      position:relative;
    }
    
    @media(max-width:900px){.container{grid-template-columns:1fr;}}
    
    .hero{
      background: linear-gradient(135deg,rgba(255,255,255,0.04),rgba(255,255,255,0.01));
      border-radius:24px;padding:40px;box-shadow:0 20px 50px rgba(2,6,23,0.6);backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.08);position:relative;
      overflow: visible; /* CHANGED FROM hidden to visible */
    }
    
    .logo{display:flex;align-items:center;gap:16px;}
    .logo .mark{
      width:60px;height:60px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--accent-2));
      display:flex;align-items:center;justify-content:center;font-weight:900;font-size:2.2rem;box-shadow:0 10px 30px var(--glow);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    h1{
      font-size:2.4rem;margin-top:25px;margin-bottom:12px;
      background:linear-gradient(90deg, var(--accent), var(--accent-2));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      background-clip:text;
    }
    
    .lead{color:rgba(230,238,248,0.85);margin:0 0 25px;line-height:1.7;font-size:1.1rem;}
    
    .stats{display:flex;gap:20px;margin-top:30px;}
    .stat{
      background:rgba(255,255,255,0.08);
      padding:18px 22px;border-radius:16px;min-width:120px;text-align:center;
      box-shadow:0 4px 20px 0 rgba(124,58,237,0.2);
      border:1px solid rgba(255,255,255,0.08);
      font-size:14px;transition:.3s;
      animation: float 4s ease-in-out infinite;
    }
    
    .stat:nth-child(1){animation-delay: 0s;}
    .stat:nth-child(2){animation-delay: 0.5s;}
    .stat:nth-child(3){animation-delay: 1s;}
    
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0px); }
    }
    
    .stat:hover{transform:scale(1.08);}
    .stat b{display:block;font-size:22px;}
    .stat span{display:block;font-size:13px;color:#c7d7ee;}
    
    .card{
      background: linear-gradient(135deg,rgba(255,255,255,0.09),rgba(255,255,255,0.04));
      padding:35px 30px;
      border-radius:20px;
      border:1px solid rgba(255,255,255,0.12);
      box-shadow:0 15px 50px rgba(2,16,33,0.7);
      position:relative;
      overflow: visible; /* CHANGED FROM hidden to visible */
    }
    
    form{display:flex;flex-direction:column;gap:16px;}
    label{font-size:15px;color:#dbebfe;letter-spacing:.004em;font-weight:600;}
    
    input[type=text],input[type=number]{
      width:100%;padding:16px 18px;border-radius:14px;border:none;
      background:rgba(10,16,23,0.6);color:#fafafc;font-size:16px;
      outline:none;border-bottom:2px solid transparent;transition:.3s box-shadow,.3s border-color;
      box-shadow:0 2px 12px 0 rgba(6,182,212,.15);
      margin-bottom:2px;
    }
    
    input:focus{
      border-bottom:2px solid var(--accent);
      box-shadow:0 0 0 4px rgba(124,58,237,0.2);
      background:rgba(15,23,42,0.8);
      animation: inputFocus 0.3s ease-out;
    }
    
    @keyframes inputFocus {
      from { box-shadow: 0 2px 12px 0 rgba(6,182,212,.15); }
      to { box-shadow: 0 0 0 4px rgba(124,58,237,0.2); }
    }
    
    .hint{font-size:12px;color:#8ed6e8;}
    .row{display:flex;gap:12px;}
    
    .btn{
      display:inline-flex;
      align-items:center;justify-content:center;
      gap:8px;padding:16px 24px;
      border-radius:14px;border:none;cursor:pointer;
      font-weight:700;font-size:16px;letter-spacing:.01em;
      background: linear-gradient(90deg,var(--accent),var(--accent-2));
      color:white;box-shadow:0 10px 30px var(--glow);
      transition:transform .15s,filter .15s;
      position:relative;overflow:hidden;
      outline:none;
      animation: buttonGlow 2s infinite alternate;
    }
    
    @keyframes buttonGlow {
      from { box-shadow: 0 10px 30px var(--glow); }
      to { box-shadow: 0 10px 30px var(--glow), 0 0 20px rgba(124,58,237,0.4); }
    }
    
    .btn:active{transform:scale(0.96);}
    .btn[disabled]{opacity:.6;cursor:not-allowed;}
    
    .btn::after{
      content:'';
      display:none;
      position:absolute;top:50%;left:50%;
      width:200%;padding-bottom:200%;
      background:rgba(124,58,237,0.15);border-radius:50%;
      transform:translate(-50%,-50%) scale(0);
      z-index:0;pointer-events:none;
      transition:transform .4s;
    }
    
    .btn:active::after{
      display:block;transform:translate(-50%,-50%) scale(1.1);
    }
    
    #status{transition:.36s;color:#fed7d7;font-weight:600;}
    .success-bounce{
      color:#79FF9D;
      animation:bounce 1s cubic-bezier(.91,-0.01,0,1.27);
    }
    .fail-shake{
      color:#FF7B99;
      animation:shake 0.6s cubic-bezier(.63,-0.59,0,1.24);
    }
    
    @keyframes bounce{30%{transform:translateY(-9px);}50%{transform:translateY(0);}75%{transform:translateY(-3px);}100%{transform:translateY(0);}}
    @keyframes shake{0%{transform:translateX(0);}20%{transform:translateX(-10px);}40%{transform:translateX(10px);}60%{transform:translateX(-6px);}80%{transform:translateX(9px);}100%{transform:translateX(0);}}
    
    .toast{
      position:fixed;left:50%;transform:translateX(-50%);
      bottom:32px;padding:16px 28px 16px 24px;
      background:rgba(10,13,25,0.95);border-radius:14px;border:1px solid rgba(255,255,255,0.08);
      box-shadow:0 12px 50px rgba(80,24,235,0.3);
      color:#baf6ff;display:flex;gap:12px;align-items:center;z-index:999;
      font-size:15px;letter-spacing:.01em;
      animation:upfade .8s;
    }
    
    @keyframes upfade{0%{opacity:.1;transform:translateX(-50%) translateY(70px);}100%{opacity:1;transform:translateX(-50%) translateY(0);}}
    
    .small{font-size:13px;color:#9fb3d9;}
    footer.small{margin-top:10px;font-size:13px;color:#95b2d7;}
    ::selection{background:rgba(124,58,237,0.14);}
    
    /* AQI Indicator */
    .aqi-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
    }
    .aqi-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    .aqi-level {
      font-size: 12px;
      font-weight: 600;
      color: #c7d7ee; /* ADDED COLOR */
    }
    .aqi-good { background-color: var(--success); }
    .aqi-moderate { background-color: var(--warning); }
    .aqi-unhealthy { background-color: var(--danger); }
    
    .progress-bar {
      height: 4px;
      background: rgba(255,255,255,0.1);
      border-radius: 2px;
      margin-top: 8px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      width: 0%;
      transition: width 1s ease;
      border-radius: 2px;
    }

    /* Spreadsheet Info */
    .spreadsheet-info {
      background: rgba(255,255,255,0.05);
      padding: 14px 18px;
      border-radius: 12px;
      margin-top: 20px;
      border-left: 4px solid var(--accent);
    }
    .spreadsheet-info .title {
      font-weight: 600;
      font-size: 14px;
      color: var(--accent-2);
    }
    .spreadsheet-info .name {
      font-size: 13px;
      color: #c7d7ee;
      margin-top: 4px;
    }

    /* India Map Section */
    .map-section {
      margin-top: 30px;
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .map-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--accent-2);
      text-align: center;
    }
    
    .india-map {
      width: 100%;
      height: 220px;
      background: 
        linear-gradient(135deg, rgba(6,182,212,0.1), rgba(124,58,237,0.1));
      border-radius: 12px;
      position: relative;
      overflow: visible; /* CHANGED FROM hidden to visible */
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .map-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 30% 40%, rgba(124,58,237,0.2) 0%, transparent 50%),
        radial-gradient(circle at 70% 60%, rgba(6,182,212,0.2) 0%, transparent 50%);
      animation: mapPulse 4s ease-in-out infinite;
      border-radius: 12px;
    }
    
    @keyframes mapPulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }
    
    .map-point {
      position: absolute;
      width: 12px;
      height: 12px;
      background: var(--accent);
      border-radius: 50%;
      box-shadow: 0 0 20px var(--accent);
      animation: pointPulse 2s infinite;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 2;
    }
    
    .map-point:hover {
      transform: scale(2);
      z-index: 10;
    }
    
    .map-point::after {
      content: attr(data-name);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(10,13,25,0.95);
      color: white;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 11px;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .map-point:hover::after {
      opacity: 1;
    }
    
    @keyframes pointPulse {
      0%, 100% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.3); opacity: 1; }
    }
    
    .cities-list {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .city-item {
      background: rgba(255,255,255,0.05);
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      color: #c7d7ee;
    }
    
    .city-item:hover {
      background: rgba(255,255,255,0.08);
      transform: translateY(-2px);
    }
    
    .city-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
    }

    /* Recent Submissions */
    .recent-submissions {
      margin-top: 25px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 15px;
      overflow: visible; /* CHANGED */
    }
    
    .submissions-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent-2);
      margin-bottom: 10px;
    }
    
    .submission-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      font-size: 12px;
      color: #c7d7ee;
    }
    
    .submission-item:last-child {
      border-bottom: none;
    }
    
    .person-name {
      color: var(--accent-2);
      font-weight: 600;
    }
    
    .submission-location {
      color: #c7d7ee;
    }
    
    .submission-aqi {
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 4px;
      background: rgba(124,58,237,0.2);
      color: white;
    }

    /* User Welcome Section */
    .user-welcome {
      margin-top: 20px;
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      text-align: center;
      overflow: visible; /* CHANGED */
    }
    
    .welcome-text {
      font-size: 14px;
      color: #9fb3d9;
      margin-bottom: 5px;
    }
    
    .user-name {
      font-size: 16px;
      font-weight: 600;
      color: var(--accent-2);
    }

    /* New Features */
    .feature-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 20px;
    }
    
    .feature {
      background: rgba(255,255,255,0.05);
      padding: 12px;
      border-radius: 10px;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      color: #c7d7ee; /* ADDED COLOR */
    }
    
    .feature:hover {
      background: rgba(255,255,255,0.08);
      transform: translateY(-2px);
    }
    
    .feature-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: white;
    }

    /* Live Data Pulse */
    .live-pulse {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: var(--success);
      border-radius: 50%;
      margin-right: 8px;
      animation: livePulse 2s infinite;
    }
    
    @keyframes livePulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.7; }
    }

    /* Quick Actions */
    .quick-actions {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }
    
    .action-btn {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      color: var(--accent);
      padding: 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .action-btn:hover {
      background: rgba(255,255,255,0.08);
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
  <!-- Air Flow Particles -->
  <div id="airFlow"></div>
  
  <!-- Wind Lines -->
  <div id="windEffect"></div>
  
  <!-- Background Bubbles -->
  <div class="bg-bubble bg-bubble1"></div>
  <div class="bg-bubble bg-bubble2"></div>
  <div class="bg-bubble bg-bubble3"></div>
  
  <div class="container">
    <section class="hero">
      <div class="logo">
        <div class="mark">AQ</div>
        <div>
          <div style="font-weight:700;font-size:1.3rem;">CrowdAQI India</div>
          <div class="small">Real-time air quality monitoring across India</div>
        </div>
      </div>
      
      <h1>Track Air Quality Across India</h1>
      <p class="lead">Join the movement for cleaner air. Submit your local AQI reading and help create a comprehensive air quality map of India.</p>
      
      <div class="stats" aria-hidden>
        <div class="stat">
          <b id="count">0</b>
          <span>Submissions</span>
        </div>
        <div class="stat">
          <b id="last">—</b>
          <span>Last AQI</span>
        </div>
        <div class="stat">
          <b id="avg">—</b>
          <span>Avg AQI</span>
        </div>
      </div>

      <!-- Feature Grid -->
      <div class="feature-grid">
        <div class="feature">
          <div class="feature-icon"><i class="fas fa-map-marker-alt"></i></div>
          <span>Live Location Tracking</span>
        </div>
        <div class="feature">
          <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
          <span>Real-time Analytics</span>
        </div>
        <div class="feature">
          <div class="feature-icon"><i class="fas fa-users"></i></div>
          <span>Community Driven</span>
        </div>
        <div class="feature">
          <div class="feature-icon"><i class="fas fa-database"></i></div>
          <span>Google Sheets Sync</span>
        </div>
      </div>

      <!-- India Map Section -->
      <div class="map-section">
        <div class="map-title">
          <span class="live-pulse"></span>
          Live AQI Coverage Across India
        </div>
        <div class="india-map">
          <div class="map-overlay"></div>
          <!-- Map points will be added dynamically -->
        </div>
        <div class="cities-list">
          <div class="city-item"><div class="city-dot"></div> Delhi</div>
          <div class="city-item"><div class="city-dot"></div> Mumbai</div>
          <div class="city-item"><div class="city-dot"></div> Bangalore</div>
          <div class="city-item"><div class="city-dot"></div> Kolkata</div>
          <div class="city-item"><div class="city-dot"></div> Chennai</div>
          <div class="city-item"><div class="city-dot"></div> Hyderabad</div>
        </div>
      </div>

      <!-- Recent Submissions -->
      <div class="recent-submissions">
        <div class="submissions-title">Recent Submissions</div>
        <div id="submissionsList">
          <div class="submission-item">
            <div>
              <span class="person-name">Rahul Sharma</span>
              <span class="submission-location"> - Delhi</span>
            </div>
            <span class="submission-aqi">AQI 156</span>
          </div>
          <div class="submission-item">
            <div>
              <span class="person-name">Priya Patel</span>
              <span class="submission-location"> - Mumbai</span>
            </div>
            <span class="submission-aqi">AQI 89</span>
          </div>
          <div class="submission-item">
            <div>
              <span class="person-name">Amit Kumar</span>
              <span class="submission-location"> - Bangalore</span>
            </div>
            <span class="submission-aqi">AQI 45</span>
          </div>
        </div>
      </div>

      <div class="spreadsheet-info">
        <div class="title">Live Data Storage:</div>
        <div class="name">CrowdAQI_Data Spreadsheet</div>
        <div class="small" style="margin-top: 5px;">Your data helps create real-time pollution maps across India</div>
      </div>
      
      <footer class="small">Tip: Be specific with your city/location for accurate mapping</footer>
    </section>
    
    <aside class="card">
      <form id="aqiForm" autocomplete="off">
        <label for="name">
          <i class="fas fa-user" style="margin-right: 8px;"></i>
          Your Name
        </label>
        <input id="name" type="text" placeholder="e.g. Ravi Kumar" required />
        
        <label for="location">
          <i class="fas fa-map-marker-alt" style="margin-right: 8px;"></i>
          City & Location
        </label>
        <input id="location" type="text" placeholder="e.g. Connaught Place, Delhi" required />
        
        <label for="aqi">
          <i class="fas fa-wind" style="margin-right: 8px;"></i>
          AQI Value
        </label>
        <input id="aqi" type="number" placeholder="e.g. 150" min="0" max="1000" required />
        
        <div class="aqi-indicator">
          <div class="aqi-dot" id="aqiDot"></div>
          <div class="aqi-level" id="aqiLevel">Enter AQI value</div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="aqiProgress"></div>
        </div>
        
        <div class="row">
          <button id="submitBtn" class="btn" type="submit">
            <i class="fas fa-cloud-upload-alt"></i>
            Submit AQI Reading
          </button>
          <button id="clearBtn" type="button" class="btn" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);color:var(--accent)">
            <i class="fas fa-eraser"></i>
            Clear
          </button>
        </div>
        <div id="status" class="hint" style="margin-top:6px;min-height:1em"></div>
      </form>

      <!-- User Welcome Section -->
      <div class="user-welcome">
        <div class="welcome-text">Welcome</div>
        <div id="userWelcome" class="user-name">Share your first AQI reading!</div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <button id="locationBtn" class="action-btn">
          <i class="fas fa-location-arrow"></i>
          My Location
        </button>
        <button id="refreshBtn" class="action-btn">
          <i class="fas fa-sync-alt"></i>
          Refresh
        </button>
      </div>
    </aside>
  </div>
  
  <div id="toast" class="toast" style="display:none">✅ <span id="toastText">Saved</span></div>
  
  <script>
    // Updated Google Apps Script Web App URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyw181xvV5ImHkh7UUB2RlDXQfNeZDC7I1nQPiq4ImIZDs68K4TisX2sdYmpyWrS2pTeQ/exec";
    const form = document.getElementById('aqiForm');
    const submitBtn = document.getElementById('submitBtn');
    const clearBtn = document.getElementById('clearBtn');
    const locationBtn = document.getElementById('locationBtn');
    const refreshBtn = document.getElementById('refreshBtn');
    const status = document.getElementById('status');
    const toast = document.getElementById('toast');
    const toastText = document.getElementById('toastText');
    const aqiInput = document.getElementById('aqi');
    const aqiDot = document.getElementById('aqiDot');
    const aqiLevel = document.getElementById('aqiLevel');
    const aqiProgress = document.getElementById('aqiProgress');
    const indiaMap = document.querySelector('.india-map');
    const userWelcome = document.getElementById('userWelcome');
    const submissionsList = document.getElementById('submissionsList');
    const nameInput = document.getElementById('name');
    const locationInput = document.getElementById('location');

    // Store recent submissions
    let recentSubmissions = [
      { name: "Rahul Sharma", location: "Delhi", aqi: 156 },
      { name: "Priya Patel", location: "Mumbai", aqi: 89 },
      { name: "Amit Kumar", location: "Bangalore", aqi: 45 }
    ];

    // Create air flow particles
    function createAirFlow() {
      const airFlow = document.getElementById('airFlow');
      for (let i = 0; i < 80; i++) {
        const particle = document.createElement('div');
        particle.className = 'air-particle';
        particle.style.width = `${Math.random() * 8 + 2}px`;
        particle.style.height = particle.style.width;
        particle.style.left = `${Math.random() * 100}vw`;
        particle.style.top = `${Math.random() * 100}vh`;
        particle.style.opacity = Math.random() * 0.4 + 0.1;
        particle.style.animationDelay = `${Math.random() * 20}s`;
        particle.style.animationDuration = `${Math.random() * 30 + 15}s`;
        
        // Random colors for particles
        const colors = [
          'rgba(124,58,237,0.3)',
          'rgba(6,182,212,0.3)',
          'rgba(255,255,255,0.2)',
          'rgba(16,185,129,0.2)'
        ];
        particle.style.background = colors[Math.floor(Math.random() * colors.length)];
        
        airFlow.appendChild(particle);
      }
    }

    // Create wind effect
    function createWindEffect() {
      const windEffect = document.getElementById('windEffect');
      for (let i = 0; i < 15; i++) {
        const windLine = document.createElement('div');
        windLine.className = 'wind-line';
        windLine.style.top = `${Math.random() * 100}vh`;
        windLine.style.width = `${Math.random() * 200 + 100}px`;
        windLine.style.opacity = Math.random() * 0.3 + 0.1;
        windLine.style.animationDelay = `${Math.random() * 8}s`;
        windLine.style.animationDuration = `${Math.random() * 10 + 5}s`;
        windEffect.appendChild(windLine);
      }
    }
    
    // Add points to India map with person names
    function addMapPoints() {
      const points = [
        { top: '35%', left: '28%', name: 'Rahul - Delhi', aqi: 156 },
        { top: '52%', left: '22%', name: 'Priya - Mumbai', aqi: 89 },
        { top: '62%', left: '32%', name: 'Amit - Bangalore', aqi: 45 },
        { top: '42%', left: '38%', name: 'Sneha - Kolkata', aqi: 178 },
        { top: '28%', left: '42%', name: 'Raj - Punjab', aqi: 67 },
        { top: '58%', left: '48%', name: 'Anjali - Chennai', aqi: 92 },
        { top: '38%', left: '32%', name: 'Vikram - UP', aqi: 134 },
        { top: '48%', left: '42%', name: 'Neha - Hyderabad', aqi: 78 }
      ];
      
      points.forEach(point => {
        const mapPoint = document.createElement('div');
        mapPoint.className = 'map-point';
        mapPoint.style.top = point.top;
        mapPoint.style.left = point.left;
        mapPoint.style.animationDelay = `${Math.random() * 2}s`;
        mapPoint.setAttribute('data-name', `${point.name} - AQI ${point.aqi}`);
        
        // Set color based on AQI
        if (point.aqi <= 50) {
          mapPoint.style.background = '#10b981';
          mapPoint.style.boxShadow = '0 0 20px #10b981';
        } else if (point.aqi <= 100) {
          mapPoint.style.background = '#f59e0b';
          mapPoint.style.boxShadow = '0 0 20px #f59e0b';
        } else {
          mapPoint.style.background = '#ef4444';
          mapPoint.style.boxShadow = '0 0 20px #ef4444';
        }
        
        indiaMap.appendChild(mapPoint);
      });
    }

    // Update user welcome message
    function updateUserWelcome() {
      nameInput.addEventListener('input', function() {
        if (this.value.trim()) {
          userWelcome.textContent = `Welcome, ${this.value}!`;
        } else {
          userWelcome.textContent = 'Share your first AQI reading!';
        }
      });
    }

    // Update recent submissions list
    function updateSubmissionsList() {
      submissionsList.innerHTML = '';
      recentSubmissions.forEach(submission => {
        const submissionItem = document.createElement('div');
        submissionItem.className = 'submission-item';
        submissionItem.innerHTML = `
          <div>
            <span class="person-name">${submission.name}</span>
            <span class="submission-location"> - ${submission.location}</span>
          </div>
          <span class="submission-aqi">AQI ${submission.aqi}</span>
        `;
        submissionsList.appendChild(submissionItem);
      });
    }

    // Add new submission to the list
    function addNewSubmission(name, location, aqi) {
      recentSubmissions.unshift({ name, location, aqi });
      if (recentSubmissions.length > 6) {
        recentSubmissions.pop();
      }
      updateSubmissionsList();
    }

    // Get user location
    locationBtn.addEventListener('click', () => {
      if (navigator.geolocation) {
        status.textContent = 'Getting your location...';
        status.className = 'hint';
        
        navigator.geolocation.getCurrentPosition(
          (position) => {
            // In real app, you would reverse geocode to get city name
            status.textContent = 'Location detected! Please enter your city.';
            status.className = 'success-bounce';
            locationInput.focus();
          },
          (error) => {
            status.textContent = 'Unable to get location. Please enter manually.';
            status.className = 'fail-shake';
          }
        );
      } else {
        status.textContent = 'Geolocation not supported by your browser.';
        status.className = 'fail-shake';
      }
    });

    // Refresh data
    refreshBtn.addEventListener('click', () => {
      status.textContent = 'Refreshing data...';
      status.className = 'hint';
      
      // Simulate data refresh
      setTimeout(() => {
        status.textContent = 'Data refreshed!';
        status.className = 'success-bounce';
        showToast('Data refreshed successfully');
      }, 1000);
    });
    
    // Update AQI indicator based on value
    function updateAqiIndicator(value) {
      if (!value || isNaN(value)) {
        aqiDot.style.backgroundColor = 'transparent';
        aqiLevel.textContent = 'Enter AQI value';
        aqiProgress.style.width = '0%';
        return;
      }
      
      const progress = Math.min((value / 500) * 100, 100);
      aqiProgress.style.width = `${progress}%`;
      
      if (value <= 50) {
        aqiDot.className = 'aqi-dot aqi-good';
        aqiLevel.textContent = 'Good Air Quality';
        aqiLevel.style.color = '#10b981';
      } else if (value <= 100) {
        aqiDot.className = 'aqi-dot aqi-moderate';
        aqiLevel.textContent = 'Moderate Air Quality';
        aqiLevel.style.color = '#f59e0b';
      } else {
        aqiDot.className = 'aqi-dot aqi-unhealthy';
        aqiLevel.textContent = 'Unhealthy Air Quality';
        aqiLevel.style.color = '#ef4444';
      }
    }
    
    function showToast(msg){
      toastText.textContent = msg;
      toast.style.display='flex';
      setTimeout(()=>toast.style.display='none',2600)
    }
    
    function setLoading(on){
      submitBtn.disabled = on;
      submitBtn.innerHTML = on ? '<i class="fas fa-spinner fa-spin"></i> Saving...' : '<i class="fas fa-cloud-upload-alt"></i> Submit AQI Reading';
    }
    
    clearBtn.addEventListener('click', ()=>{ 
      form.reset(); 
      status.textContent=''; 
      status.className='hint'; 
      updateAqiIndicator(null);
      userWelcome.textContent = 'Share your first AQI reading!';
    });
    
    aqiInput.addEventListener('input', (e) => {
      updateAqiIndicator(Number(e.target.value));
    });
    
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const location = document.getElementById('location').value.trim();
      const aqi = Number(document.getElementById('aqi').value);
      
      if(!name || !location || isNaN(aqi)){
        status.textContent = 'Please fill all fields with valid values.'; 
        status.className='fail-shake'; 
        return;
      }
      
      setLoading(true); 
      status.textContent='';
      
      try {
        // Using URL parameters for GET request
        const params = new URLSearchParams();
        params.append('name', name);
        params.append('location', location);
        params.append('aqi', aqi);
        
        const response = await fetch(`${SCRIPT_URL}?${params.toString()}`, {
          method: 'GET',
          mode: 'no-cors'
        });
        
        showToast('Data submitted to India Map!');
        form.reset();
        status.textContent = '✓ Added to India AQI Map!';
        status.className='success-bounce';
        updateAqiIndicator(null);
        
        // Add to recent submissions
        addNewSubmission(name, location, aqi);
        
        // Update stats with animation
        const cntEl = document.getElementById('count');
        cntEl.textContent = Number(cntEl.textContent||0)+1;
        document.getElementById('last').textContent = aqi;
        
        // Reset welcome message
        userWelcome.textContent = 'Share your first AQI reading!';
        
        // Animate the updated stat
        cntEl.parentElement.animate([
          { transform: 'scale(1)' },
          { transform: 'scale(1.2)' },
          { transform: 'scale(1)' }
        ], { duration: 500 });
        
      } catch(err) {
        console.error('Submission error:', err);
        status.textContent = '❌ Submission failed — check connection!';
        status.className='fail-shake';
        showToast('Failed to save — try again');
      } finally { 
        setLoading(false);
      }
    });
    
    // Initialize animations and features
    createAirFlow();
    createWindEffect();
    addMapPoints();
    updateUserWelcome();
    updateSubmissionsList();
    
    // subtle stats pulse
    setInterval(()=>{
      const el=document.querySelector('.stats');
      if(!el)return;
      el.animate([{transform:'scale(1)'},{transform:'scale(1.04)'},{transform:'scale(1)'}],{duration:1200}).finished.catch(()=>{});
    },5400);
  </script>
</body>
</html>